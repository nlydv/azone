# azone
DNSSEC zone signing and key management command-line tool. This bash wrapper script simplifies the use of [NSD](https://github.com/NLnetLabs/nsd), an authoritative-only DNS nameserver, and some of its related [ldns](https://github.com/NLnetLabs/ldns) tools.
![azone help screenshot](https://files.neelyadav.com/misc/azone-preview.png)
#### Purpose
For those wanting to operate their own authoritative DNS server while also implementing DNSSEC, the number of moving parts involved and all the functions, options, parameters, etc. of the numerous dnssec-* or ldns-* CLI tools one would have to remember makes it a much more involved, cumbersome, and time consuming task than it really needs to be.

Surprisingly, there aren't a whole lot of simple free or open source tools out there (that I could find) that streamlines all of this for anyone wanting to self-host their domains.

Which is why I ended up compiling a set of shell functions for my own use. Once the complexity of it all got past the point of your typical ease-of-use shortcut (and it still seemed to work fine), I figured I might as well package it all up into one nice script for anyone else who'd benefit from using it.

## Features
- Straight forward key generation & zone signing
- Automated directory organization of keys and zones
- One command to push all changes to live NSD server
- Auto-increments SOA serial value
- Maintains cron file for weekly zone re-signing
- Import and sort existing keys
- DNSSEC chain validation for [Handshake](https://handshake.org) domains

## Requirements

>The script won't work out of the box if you're using something like BIND & dnssec-tools. If you don't want to use NSD, the `azone update` command won't do anything. As long as you have ldns installed, everything else should work fine and you can manually relay changes or set configs for your preferred DNS server as needed.

Of course, having an authoritative nameserver is the main requirement. This tool is just a wrapper of certain NSD & ldns commands. I think all the other commands used are standard on Linux distros? Oh and I guess you need Bash too.

Either build from source using instructions from [nlnetlabs/nsd](https://github.com/NLnetLabs/nsd) and [nlnetlabs/ldns](https://github.com/NLnetLabs/ldns) or get them via your package manager:

- **Debian/Ubuntu**

    `sudo apt install nsd ldnsutils`

<sup>(add other package managers here)</sup>

## Installation
> You should get the whole repo because it also contains a set of files with root trust anchor keys under *data/* that are needed to use the `azone test` command. The rest of the files and directory structure will be generated by the script itself.

#### Donwload

```bash
git clone https://github.com/nlydv/azone.git
sudo rm -rf azone/.git
```
Since you'll be storing zonefiles and generating keys into the directory, it's best to avoid accidental git operations that could delete everything. Hence removing the .git directory.

#### Move stuff
```bash
sudo mv azone/azone /usr/local/bin/azone
sudo mv azone /etc/nsd/azone
```
You can move the script to wherever you like that's accessible via your $PATH variable, /usr/local/bin is just a common spot.

The script does have its ZONEDIR variable hardcoded to be /etc/nsd/azone though, if you want to change that just edit that variable in the script. There's a few a other configurable locations at the top of the script too.

## Usage
The `azone help` has pretty straight forward descriptions of the commands:
![azone help screenshot](https://files.neelyadav.com/misc/azone-help.png)
<sup><sup style="opacity: 50%">I just realized that <span style="text-decoration: underline">COMANDS</span> is misspelled...</sup></sup>

#### Notes on specific comands
- **`import`** will only find existing keys that follow the `K<name>+<alg>+<id>` naming scheme
- **`test -g`** or "global" DNSSEC validation, may act finicky... I think that might have to do with how ldns-verify-zone uses /etc/resolv.conf to do recursive resolution
- **`keygen`** always creates
  - ECDSAP256SHA256 keys (aka DNSKEY algo #13)
  - SHA-256 key digests (aka DS algo #2)

#### More usage notes
- **`ZONE`** should be the fully-qualified domain name, or FQDN, of interest (without trailing dot)

- By default, the associated plain zone file should also simply be named `ZONE` rather than the common naming schemes of `ZONE.zone` or `ZONE.txt` for simplicity's sake and because errors may occur with domains underneath the .zone or .txt TLDs.

- Plain zonefiles should be placed in the top directory `/etc/nsd/azone`.

- This script DOES NOT (currently) manage or update or create the actual *plain* zonefiles, only *signed* zonefiles. You should make those manually (or with some other program).

- This script can handle auto-incrementing your zones' SOA serial numbers every time it gets signed. Just place `SIGNED_ON` where the actual serial number would otherwise go in your plain zone files.

- There's a dynamic cron file at data/azone.cron that auto resigns live zones every week. Move/symlink to wherever your crons go, if you have an /etc/cron.d dir it's already symlinked. In any
case, RRSIGs created with azone have a shelf life of 36.5 days.

## Forewarnings
There's no guarantee this script is portable.<br>Developed on:
- Ubuntu 18.04
- Bash 4.4.20
- NSD 4.1.17
- ldns 1.7.0
